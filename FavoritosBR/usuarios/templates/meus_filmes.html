{% extends "base.html" %}
{% load static %}

{% block title %}Meus Filmes{% endblock %}

{% block content %}
<h1>Meus Filmes</h1>

<h2>‚≠ê Favoritados</h2>
<ul>
{% for filme in favoritos %}
    <li style="margin-bottom: 1em;">
        {% if filme.poster %}
            <img src="{{ filme.poster }}" alt="P√¥ster de {{ filme.titulo }}" style="height: 100px;">
        {% endif %}
        <strong>{{ filme.titulo }}</strong> ({{ filme.created_at|date:"d/m/Y" }})
        <button class="marcar-assistido" data-filme-id="{{ filme.filme_id_api }}">‚úÖ Marcar como assistido</button>
    </li>
{% empty %}
    <li>Voc√™ ainda n√£o favoritou filmes.</li>
{% endfor %}
</ul>

<h2>üé¨ Assistidos</h2>
<ul>
{% for filme in assistidos %}
    <li style="margin-bottom: 1em;">
        {% if filme.poster %}
      <img src="{{ filme.poster }}" alt="P√¥ster de {{ filme.titulo }}" style="height: 100px;">
        {% else %}
      <div style="height: 100px; width: 70px; background: #eee;">Sem imagem</div>
        {% endif %}
        <strong>{{ filme.titulo }}</strong> ({{ filme.assistiu_at|date:"d/m/Y" }})
    </li>
{% empty %}
    <li>Voc√™ ainda n√£o marcou filmes como assistidos.</li>
{% endfor %}
</ul>

<script>
document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".marcar-assistido").forEach(botao => {
        botao.addEventListener("click", () => {
            const filme_id = botao.getAttribute("data-filme-id");

            fetch("{% url 'marcar_como_assistido' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({ filme_id_api: parseInt(filme_id) })
            })
            .then(response => response.json())
            .then(data => {
                if (data.sucesso) {
                    location.reload();
                } else {
                    alert("Erro ao marcar como assistido.");
                }
            });
        });
    });
});
</script>
{% endblock %}

